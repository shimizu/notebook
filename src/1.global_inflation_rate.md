---
theme: light
title: 世界のインフレ率
toc: false
---

```js
import DeckClass from "npm:deck.gl";
import {Legend} from "./components/Legend.js";
```


```js
let d3tmp =  d3.color.prototype.toRGB = function(){ return [this.r,  this.g, this.b] }
```

```js
const {DeckGL,GeoJsonLayer,TextLayer} = DeckClass;
```

```js
const inflation_rate = FileAttachment("data/global_inflation_rate/inflation-s.json").json();
```

```js
inflation_rate
```

# 世界のインフレ率

```js
const year = view(Inputs.range([2000, 2023], {width:400,label: "Year", step: 1, value:2023}));
```

```js
const colorScale = d3.scaleThreshold([
    0,  3,  5,  10,  50, 100],
    ["#1B5DAA","#F5A623","#F86285",  "#F50B40", "#C70833", "darkred", "#220000" ]  )
```

```js
Legend(colorScale, {
  title: "インフレ率",
  tickSize: 0
})
```


<figure style="max-width: none; position: relative;">
  <div id="map" style="border-radius: 8px; overflow: hidden; background: rgb(18, 35, 48); height: 600px; margin: 1rem 0; "></div>
</figure>




```js
//deck.gl初期化
const initialViewState = {
  longitude: -2,
  latitude: 53.5,
  zoom: 1,
  minZoom: 0,
  maxZoom: 15,
};
```

```js
const deck = new DeckGL({
  container:document.querySelector("#map"),
  initialViewState,
  controller: true
});
```



```js
year;
console.log("draw")
deck.setProps({
  layers: [
    new GeoJsonLayer({
        id: "land-layer",
        data: inflation_rate,
        lineWidthMinPixels: 1,
        getLineColor: [60, 60, 60],
        getFillColor: d=>{
            const value =  d.properties["Y"+year];
            if(!value) return [120,120,120];
            return d3.color(colorScale(value)).toRGB()
        },
        updateTriggers:{
            getFillColor:year
        }

    }),
    new TextLayer({
        id: 'TextLayer',
        data: inflation_rate.features,
        getPosition: d => [d.properties.lng,d.properties.lat],
        getText: d => {
            const value =  d.properties["Y"+year];
            if(!value) return "";
            return value.toString()
        } ,
        getAlignmentBaseline: 'center',
        getColor: [255, 255, 255],
        getSize: 12,
        getTextAnchor: 'middle',
        updateTriggers:{
            getText:year
        }
    })
  ]
});

 ```



